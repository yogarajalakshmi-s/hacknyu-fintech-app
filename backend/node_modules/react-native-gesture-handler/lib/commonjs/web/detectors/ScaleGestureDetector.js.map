{"version":3,"names":["_constants","require","_interfaces","_defineProperty","e","r","t","_toPropertyKey","Object","defineProperty","value","enumerable","configurable","writable","i","_toPrimitive","Symbol","toPrimitive","call","TypeError","String","Number","ScaleGestureDetector","constructor","callbacks","onScaleBegin","onScale","onScaleEnd","spanSlop","DEFAULT_TOUCH_SLOP","minSpan","onTouchEvent","event","tracker","currentTime","time","action","eventType","numOfPointers","trackedPointersCount","streamComplete","EventTypes","UP","ADDITIONAL_POINTER_UP","CANCEL","DOWN","inProgress","initialSpan","configChanged","ADDITIONAL_POINTER_DOWN","pointerUp","ignoredPointer","pointerId","undefined","div","coordsSum","getAbsoluteCoordsSum","focusX","x","focusY","y","devSumX","devSumY","trackedPointers","forEach","key","Math","abs","abosoluteCoords","devX","devY","spanX","spanY","span","hypot","wasInProgress","_focusX","_focusY","prevSpan","_currentSpan","prevTime","MOVE","currentSpan","calculateScaleFactor","timeDelta","exports","default"],"sources":["ScaleGestureDetector.ts"],"sourcesContent":["import { DEFAULT_TOUCH_SLOP } from '../constants';\nimport { AdaptedEvent, EventTypes } from '../interfaces';\n\nimport PointerTracker from '../tools/PointerTracker';\n\nexport interface ScaleGestureListener {\n  onScaleBegin: (detector: ScaleGestureDetector) => boolean;\n  onScale: (detector: ScaleGestureDetector) => boolean;\n  onScaleEnd: (detector: ScaleGestureDetector) => void;\n}\n\nexport default class ScaleGestureDetector implements ScaleGestureListener {\n  public onScaleBegin: (detector: ScaleGestureDetector) => boolean;\n  public onScale: (detector: ScaleGestureDetector) => boolean;\n  public onScaleEnd: (detector: ScaleGestureDetector) => void;\n\n  private _focusX!: number;\n  private _focusY!: number;\n\n  private _currentSpan!: number;\n  private prevSpan!: number;\n  private initialSpan!: number;\n\n  private currentTime!: number;\n  private prevTime!: number;\n\n  private inProgress = false;\n\n  private spanSlop: number;\n  private minSpan: number;\n\n  constructor(callbacks: ScaleGestureListener) {\n    this.onScaleBegin = callbacks.onScaleBegin;\n    this.onScale = callbacks.onScale;\n    this.onScaleEnd = callbacks.onScaleEnd;\n\n    this.spanSlop = DEFAULT_TOUCH_SLOP * 2;\n    this.minSpan = 0;\n  }\n\n  public onTouchEvent(event: AdaptedEvent, tracker: PointerTracker): boolean {\n    this.currentTime = event.time;\n\n    const action: EventTypes = event.eventType;\n    const numOfPointers = tracker.trackedPointersCount;\n\n    const streamComplete: boolean =\n      action === EventTypes.UP ||\n      action === EventTypes.ADDITIONAL_POINTER_UP ||\n      action === EventTypes.CANCEL;\n\n    if (action === EventTypes.DOWN || streamComplete) {\n      if (this.inProgress) {\n        this.onScaleEnd(this);\n        this.inProgress = false;\n        this.initialSpan = 0;\n      }\n\n      if (streamComplete) {\n        return true;\n      }\n    }\n\n    const configChanged: boolean =\n      action === EventTypes.DOWN ||\n      action === EventTypes.ADDITIONAL_POINTER_UP ||\n      action === EventTypes.ADDITIONAL_POINTER_DOWN;\n\n    const pointerUp = action === EventTypes.ADDITIONAL_POINTER_UP;\n\n    const ignoredPointer: number | undefined = pointerUp\n      ? event.pointerId\n      : undefined;\n\n    // Determine focal point\n\n    const div: number = pointerUp ? numOfPointers - 1 : numOfPointers;\n\n    const coordsSum = tracker.getAbsoluteCoordsSum();\n\n    const focusX = coordsSum.x / div;\n    const focusY = coordsSum.y / div;\n\n    // Determine average deviation from focal point\n\n    let devSumX = 0;\n    let devSumY = 0;\n\n    tracker.trackedPointers.forEach((value, key) => {\n      if (key === ignoredPointer) {\n        return;\n      }\n\n      devSumX += Math.abs(value.abosoluteCoords.x - focusX);\n      devSumY += Math.abs(value.abosoluteCoords.y - focusY);\n    });\n\n    const devX: number = devSumX / div;\n    const devY: number = devSumY / div;\n\n    const spanX: number = devX * 2;\n    const spanY: number = devY * 2;\n\n    const span = Math.hypot(spanX, spanY);\n\n    // Begin/end events\n    const wasInProgress: boolean = this.inProgress;\n    this._focusX = focusX;\n    this._focusY = focusY;\n\n    if (this.inProgress && (span < this.minSpan || configChanged)) {\n      this.onScaleEnd(this);\n      this.inProgress = false;\n      this.initialSpan = span;\n    }\n\n    if (configChanged) {\n      this.initialSpan = this.prevSpan = this._currentSpan = span;\n    }\n\n    if (\n      !this.inProgress &&\n      span >= this.minSpan &&\n      (wasInProgress || Math.abs(span - this.initialSpan) > this.spanSlop)\n    ) {\n      this.prevSpan = this._currentSpan = span;\n      this.prevTime = this.currentTime;\n      this.inProgress = this.onScaleBegin(this);\n    }\n\n    // Handle motion\n    if (action !== EventTypes.MOVE) {\n      return true;\n    }\n\n    this._currentSpan = span;\n\n    if (this.inProgress && !this.onScale(this)) {\n      return true;\n    }\n\n    this.prevSpan = this.currentSpan;\n    this.prevTime = this.currentTime;\n\n    return true;\n  }\n\n  public calculateScaleFactor(numOfPointers: number): number {\n    if (numOfPointers < 2) {\n      return 1;\n    }\n\n    return this.prevSpan > 0 ? this.currentSpan / this.prevSpan : 1;\n  }\n\n  public get currentSpan() {\n    return this._currentSpan;\n  }\n\n  public get focusX() {\n    return this._focusX;\n  }\n\n  public get focusY() {\n    return this._focusY;\n  }\n\n  public get timeDelta() {\n    return this.currentTime - this.prevTime;\n  }\n}\n"],"mappings":"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","ignoreList":[]}