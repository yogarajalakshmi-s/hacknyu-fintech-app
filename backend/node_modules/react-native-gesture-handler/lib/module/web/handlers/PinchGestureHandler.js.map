{"version":3,"names":["State","DEFAULT_TOUCH_SLOP","GestureHandler","ScaleGestureDetector","PinchGestureHandler","constructor","args","_defineProperty","onScaleBegin","detector","startingSpan","currentSpan","onScale","prevScaleFactor","scale","calculateScaleFactor","tracker","trackedPointersCount","delta","timeDelta","velocity","Math","abs","spanSlop","state","BEGAN","activate","onScaleEnd","_detector","scaleDetectorListener","init","ref","propsRef","shouldCancelWhenOutside","transformNativeEvent","focalX","scaleGestureDetector","focusX","focalY","focusY","onPointerDown","event","addToTracker","tryToSendTouchEvent","onPointerAdd","tryBegin","onTouchEvent","onPointerUp","removeFromTracker","pointerId","ACTIVE","end","fail","onPointerRemove","onPointerMove","track","onPointerOutOfBounds","UNDETERMINED","resetProgress","begin","force","onReset"],"sources":["PinchGestureHandler.ts"],"sourcesContent":["import { State } from '../../State';\nimport { DEFAULT_TOUCH_SLOP } from '../constants';\nimport { AdaptedEvent } from '../interfaces';\n\nimport GestureHandler from './GestureHandler';\nimport ScaleGestureDetector, {\n  ScaleGestureListener,\n} from '../detectors/ScaleGestureDetector';\n\nexport default class PinchGestureHandler extends GestureHandler {\n  private scale = 1;\n  private velocity = 0;\n\n  private startingSpan = 0;\n  private spanSlop = DEFAULT_TOUCH_SLOP;\n\n  private scaleDetectorListener: ScaleGestureListener = {\n    onScaleBegin: (detector: ScaleGestureDetector): boolean => {\n      this.startingSpan = detector.currentSpan;\n      return true;\n    },\n    onScale: (detector: ScaleGestureDetector): boolean => {\n      const prevScaleFactor: number = this.scale;\n      this.scale *= detector.calculateScaleFactor(\n        this.tracker.trackedPointersCount\n      );\n\n      const delta = detector.timeDelta;\n      if (delta > 0) {\n        this.velocity = (this.scale - prevScaleFactor) / delta;\n      }\n\n      if (\n        Math.abs(this.startingSpan - detector.currentSpan) >= this.spanSlop &&\n        this.state === State.BEGAN\n      ) {\n        this.activate();\n      }\n      return true;\n    },\n    onScaleEnd: (\n      _detector: ScaleGestureDetector\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\n    ): void => {},\n  };\n\n  private scaleGestureDetector: ScaleGestureDetector = new ScaleGestureDetector(\n    this.scaleDetectorListener\n  );\n\n  public init(ref: number, propsRef: React.RefObject<unknown>) {\n    super.init(ref, propsRef);\n\n    this.shouldCancelWhenOutside = false;\n  }\n\n  protected transformNativeEvent() {\n    return {\n      focalX: this.scaleGestureDetector.focusX,\n      focalY: this.scaleGestureDetector.focusY,\n      velocity: this.velocity,\n      scale: this.scale,\n    };\n  }\n\n  protected onPointerDown(event: AdaptedEvent): void {\n    this.tracker.addToTracker(event);\n    super.onPointerDown(event);\n\n    this.tryToSendTouchEvent(event);\n  }\n\n  protected onPointerAdd(event: AdaptedEvent): void {\n    this.tracker.addToTracker(event);\n    super.onPointerAdd(event);\n    this.tryBegin();\n    this.scaleGestureDetector.onTouchEvent(event, this.tracker);\n  }\n\n  protected onPointerUp(event: AdaptedEvent): void {\n    super.onPointerUp(event);\n    this.tracker.removeFromTracker(event.pointerId);\n    if (this.state !== State.ACTIVE) {\n      return;\n    }\n    this.scaleGestureDetector.onTouchEvent(event, this.tracker);\n\n    if (this.state === State.ACTIVE) {\n      this.end();\n    } else {\n      this.fail();\n    }\n  }\n\n  protected onPointerRemove(event: AdaptedEvent): void {\n    super.onPointerRemove(event);\n    this.scaleGestureDetector.onTouchEvent(event, this.tracker);\n    this.tracker.removeFromTracker(event.pointerId);\n\n    if (this.state === State.ACTIVE && this.tracker.trackedPointersCount < 2) {\n      this.end();\n    }\n  }\n\n  protected onPointerMove(event: AdaptedEvent): void {\n    if (this.tracker.trackedPointersCount < 2) {\n      return;\n    }\n    this.tracker.track(event);\n\n    this.scaleGestureDetector.onTouchEvent(event, this.tracker);\n    super.onPointerMove(event);\n  }\n  protected onPointerOutOfBounds(event: AdaptedEvent): void {\n    if (this.tracker.trackedPointersCount < 2) {\n      return;\n    }\n    this.tracker.track(event);\n\n    this.scaleGestureDetector.onTouchEvent(event, this.tracker);\n    super.onPointerOutOfBounds(event);\n  }\n\n  private tryBegin(): void {\n    if (this.state !== State.UNDETERMINED) {\n      return;\n    }\n\n    this.resetProgress();\n    this.begin();\n  }\n\n  public activate(force?: boolean): void {\n    if (this.state !== State.ACTIVE) {\n      this.resetProgress();\n    }\n\n    super.activate(force);\n  }\n\n  protected onReset(): void {\n    this.resetProgress();\n  }\n\n  protected resetProgress(): void {\n    if (this.state === State.ACTIVE) {\n      return;\n    }\n    this.velocity = 0;\n    this.scale = 1;\n  }\n}\n"],"mappings":"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","ignoreList":[]}